# Configuration file for Kaggle GPU Validation
# Extends core ARZ configuration with Kaggle-specific optimizations

# Kaggle validation configuration
kaggle_validation:
  enabled: true
  mode: "gpu_chain"  # Options: "single", "gpu_chain", "performance"
  memory_limit_gb: 16.0  # T4 GPU memory constraint
  max_kernel_time_sec: 3600.0  # 1 hour per kernel max
  adaptive_grid: true  # Enable grid size adaptation for GPU
  max_N_gpu: 500  # Maximum grid size for GPU validation
  chain_phases:
    - "infrastructure"
    - "analytical" 
    - "performance"
    - "rl"
    - "synthesis"
  
  # Success criteria for R1-R6 validation
  success_criteria:
    R1_convergence_order: 4.0      # WENO5 theoretical order
    R2_calibration_mape: 15.0      # Victoria Island calibration target
    R3_mass_conservation: 1.0e-6   # Mass conservation error limit
    R4_min_segments: 50            # Minimum segments for behavioral validation
    R5_rl_improvement: 20.0        # RL performance improvement percentage
    R6_consistency_error: 1.0e-10  # GPU vs CPU numerical consistency

# Scenario configuration optimized for Kaggle GPU
scenario_name: "kaggle_gpu_validation"

# Grid configuration (will be adapted based on GPU memory)
grid:
  N: 400  # Initial size, will be optimized for GPU
  xmin: 0.0
  xmax: 1000.0

# Simulation parameters optimized for kernel time limits
simulation:
  t_final_sec: 300.0   # Shorter simulation for kernel constraints
  output_dt_sec: 10.0

# Numerical methods
numerical:
  spatial_scheme: "weno5"
  time_scheme: "ssprk3"
  cfl_number: 0.8

# Initial conditions for validation testing
initial_conditions:
  type: "riemann"
  left_state: [0.1, 25.0, 0.2, 15.0]   # [rho_m, v_m, rho_c, v_c] in SI units
  right_state: [0.3, 10.0, 0.1, 20.0]

# Boundary conditions
boundary_conditions:
  left:
    type: "inflow"
    state: [0.1, 25.0, 0.2, 15.0]  # [rho_m_veh_km, v_m_kmh, rho_c_veh_km, v_c_kmh] - will be converted
  right:
    type: "outflow"

# Enable GPU device by default
device: "gpu"

# Enable mass conservation monitoring
mass_conservation_check: true

# Network configuration for performance testing
network:
  has_network: false  # Single segment for basic validation
  segments: []
  nodes: []

# Traffic light parameters
enable_traffic_lights: false  # Simplified for validation
enable_creeping: true
enable_queue_management: false

# Kaggle-specific optimizations
kaggle_optimizations:
  memory_efficient_arrays: true
  reduced_output_frequency: true
  checkpoint_every_n_steps: 100
  early_termination_on_divergence: true
  gpu_memory_monitoring: true