================================================================================
ğŸ§  ENHANCED ARCHITECTURE ANALYSIS V3.1
================================================================================


================================================================================

ğŸ“‚ Loading dependency graph...

ğŸ“¦ LOADED:
  - 105 modules
  - 414 functions
  - 63 classes

================================================================================
ğŸ” SCANNING FOR DECORATORS AND SPECIAL PATTERNS (v3.1 FIXED)
================================================================================

ğŸ”¬ Scanning 75 Python files for decorators...

ğŸ” DEBUG - Decorators found: 71
  âœ“ validate_x_max @field_validator in arz_model/config/network_simulation_config.py
  âœ“ validate_x_max @classmethod in arz_model/config/network_simulation_config.py
  âœ“ validate_N @field_validator in arz_model/config/network_simulation_config.py
  âœ“ validate_N @classmethod in arz_model/config/network_simulation_config.py
  âœ“ validate_type @field_validator in arz_model/config/network_simulation_config.py
  âœ“ validate_type @classmethod in arz_model/config/network_simulation_config.py
  âœ“ validate_position @field_validator in arz_model/config/network_simulation_config.py
  âœ“ validate_position @classmethod in arz_model/config/network_simulation_config.py
  âœ“ validate_traffic_light_config @field_validator in arz_model/config/network_simulation_config.py
  âœ“ validate_traffic_light_config @classmethod in arz_model/config/network_simulation_config.py

ğŸ” DEBUG - Pytest tests found: 56
  âœ“ test_dt_min_protection_triggers in arz_model/tests/test_dt_min_protection.py
  âœ“ test_dt_min_protection_allows_stable_runs in arz_model/tests/test_dt_min_protection.py
  âœ“ test_stable_simulation_completes in arz_model/tests/test_dt_min_protection_v2.py
  âœ“ test_high_density_simulation_stability in arz_model/tests/test_dt_min_protection_v2.py
  âœ“ test_cuda_availability_check in arz_model/tests/test_gpu_memory_pool.py
  âœ“ test_valid_initialization in arz_model/tests/test_gpu_memory_pool.py
  âœ“ test_segment_mismatch_validation in arz_model/tests/test_gpu_memory_pool.py
  âœ“ test_streams_configuration in arz_model/tests/test_gpu_memory_pool.py
  âœ“ test_segment_state_access in arz_model/tests/test_gpu_memory_pool.py
  âœ“ test_road_quality_access in arz_model/tests/test_gpu_memory_pool.py

ğŸ” DEBUG - Main calls found: 81
  âœ“ main called from main in arz_model/main_network_builder.py
  âœ“ print called from main in arz_model/main_network_simulation.py
  âœ“ print called from main in arz_model/main_network_simulation.py
  âœ“ print called from main in arz_model/main_network_simulation.py
  âœ“ flush called from main in arz_model/main_network_simulation.py
  âœ“ main called from main in arz_model/main_network_simulation.py
  âœ“ print called from main in arz_model/main_network_simulation.py
  âœ“ print called from main in arz_model/main_network_simulation.py
  âœ“ print called from main in arz_model/main_network_simulation.py
  âœ“ flush called from main in arz_model/main_network_simulation.py

ğŸ“Š DECORATOR DETECTION RESULTS:
  - 63 functions with decorators
  - 56 pytest test functions (test_*)
  - 0 pytest fixtures (@pytest.fixture)
  - 12 Pydantic validators (@field_validator)
  - 0 property methods (@property)
  - 10 class methods (@classmethod)
  - 1 static methods (@staticmethod)
  - 38 main entry point calls (if __name__ == '__main__')

================================================================================
ğŸ”— BUILDING ENHANCED CALL GRAPH
================================================================================
Total dependencies: 429
  - 279 functions that call others
  - 187 functions that are called

================================================================================
âš ï¸  ENHANCED DEAD CODE DETECTION
================================================================================

ğŸ“Š RESULTS:
  - 83 CONFIRMED DEAD functions
  - 116 SUSPECTED FALSE POSITIVES
  - Total analyzed: 290

================================================================================
ğŸš¨ SUSPECTED FALSE POSITIVES (DO NOT DELETE)
================================================================================

These functions appear 'dead' but are likely called via:
  - Decorators (@pytest.fixture, @field_validator, @property)
  - Indirect class calls (e.g., SSP_RK3_GPU().integrate())
  - Main entry points (if __name__ == '__main__')
  - Public API conventions (run, get_*, set_*)
================================================================================

ğŸ” Decorated/special function (pytest/field_validator/property/etc.) (70 functions)
--------------------------------------------------------------------------------

   ğŸ“„ arz_model/benchmarks/benchmark_gpu_only.py
      âœ“ benchmark_simulation_performance
      âœ“ profile_memory_usage

   ğŸ“„ arz_model/config/network_simulation_config.py
      âœ“ validate_coupling_type
      âœ“ validate_segments
      âœ“ validate_type
      âœ“ validate_x_max

   ğŸ“„ arz_model/config/time_config.py
      âœ“ output_dt_must_be_less_than_t_final

   ğŸ“„ arz_model/core/node_solver_gpu.py
      âœ“ solve_node_fluxes_gpu

   ğŸ“„ arz_model/core/physics.py
      âœ“ _calculate_supply_flux_cuda
      âœ“ _invert_flux_function_cuda
      âœ“ calculate_equilibrium_speed_gpu
      âœ“ calculate_relaxation_time_gpu
      âœ“ calculate_source_term_gpu

   ğŸ“„ arz_model/main_network_builder.py
      âœ“ main

   ğŸ“„ arz_model/main_network_simulation.py
      âœ“ main

   ğŸ“„ arz_model/numerics/gpu/network_coupling_gpu.py
      âœ“ _apply_coupling_batched_kernel
      âœ“ _apply_coupling_kernel

   ğŸ“„ arz_model/numerics/gpu/ssp_rk3_cuda.py
      âœ“ batched_ssp_rk3_kernel

   ğŸ“„ arz_model/numerics/gpu/weno_cuda.py
      âœ“ apply_boundary_conditions_kernel
      âœ“ weno5_reconstruction_optimized_kernel

   ğŸ“„ arz_model/numerics/reconstruction/converter.py
      âœ“ conserved_to_primitives_arr
      âœ“ primitives_to_conserved_arr

   ğŸ“„ arz_model/numerics/reconstruction/weno_gpu.py
      âœ“ _apply_positivity_limiter_gpu_device
      âœ“ _central_upwind_flux_gpu_device
      âœ“ _primitives_to_conserved_gpu_device

   ğŸ“„ arz_model/numerics/riemann_solvers.py
      âœ“ _central_upwind_flux_cuda

   ğŸ“„ arz_model/road_network/models.py
      âœ“ must_be_positive

   ğŸ“„ arz_model/simulation/runner.py
      âœ“ _validate_gpu_architecture

   ğŸ“„ arz_model/tests/test_dt_min_protection.py
      âœ“ test_dt_min_protection_allows_stable_runs
      âœ“ test_dt_min_protection_triggers

   ğŸ“„ arz_model/tests/test_dt_min_protection_v2.py
      âœ“ test_high_density_simulation_stability
      âœ“ test_stable_simulation_completes

   ğŸ“„ arz_model/tests/test_gpu_memory_pool.py
      âœ“ test_asynchronous_checkpoint
      âœ“ test_checkpoint_invalid_segment
      âœ“ test_destructor_cleanup
      âœ“ test_invalid_initialization
      âœ“ test_memory_persistence
      âœ“ test_road_quality_access
      âœ“ test_segment_mismatch_validation
      âœ“ test_segment_state_access
      âœ“ test_state_initialization_full_array
      âœ“ test_state_initialization_physical_only
      âœ“ test_stream_access
      âœ“ test_string_representation
      âœ“ test_synchronous_checkpoint

   ğŸ“„ arz_model/tests/test_gpu_only_integration.py
      âœ“ test_gpu_required_error
      âœ“ test_mass_conservation_gpu
      âœ“ test_simulation_runs_end_to_end_on_gpu

   ğŸ“„ arz_model/tests/test_gpu_optimizations.py
      âœ“ test_device_function_integration
      âœ“ test_optimized_kernels_import
      âœ“ test_physical_bounds_preservation
      âœ“ test_simulation_stability_30s

   ğŸ“„ arz_model/tests/test_network_config_cache.py
      âœ“ test_cache_clear
      âœ“ test_cache_save_and_load
      âœ“ test_fingerprint_changes_on_param_change
      âœ“ test_fingerprint_stability
      âœ“ test_osm_integration
      âœ“ test_victoria_island_with_cache

   ğŸ“„ arz_model/tests/test_positivity_preservation.py
      âœ“ test_physics_config_validates_positivity_bounds

   ğŸ“„ arz_model/tests/test_ssp_rk3_fusion.py
      âœ“ test_class_interface_consistency
      âœ“ test_constant_state_preservation_fused
      âœ“ test_equivalence_various_dt
      âœ“ test_equivalence_various_sizes
      âœ“ test_equivalence_zero_flux_discontinuous
      âœ“ test_equivalence_zero_flux_random
      âœ“ test_equivalence_zero_flux_smooth
      âœ“ test_linearity_fused
      âœ“ test_multiple_timesteps_consistency
      âœ“ test_performance_comparison
      âœ“ test_very_small_dt

ğŸ” GPU kernel (called indirectly via classes) (13 functions)
--------------------------------------------------------------------------------

   ğŸ“„ arz_model/numerics/cfl.py
      âœ“ _calculate_max_wavespeed_batched_kernel
      âœ“ _calculate_max_wavespeed_kernel

   ğŸ“„ arz_model/numerics/gpu/utils.py
      âœ“ profile_gpu_kernel

   ğŸ“„ arz_model/numerics/reconstruction/converter.py
      âœ“ conserved_to_primitives_kernel
      âœ“ primitives_to_conserved_kernel

   ğŸ“„ arz_model/numerics/reconstruction/weno_gpu.py
      âœ“ _compute_flux_divergence_weno_kernel
      âœ“ _compute_weno_fluxes_kernel
      âœ“ apply_weno_boundary_conditions_kernel

   ğŸ“„ arz_model/numerics/riemann_solvers.py
      âœ“ central_upwind_flux_cuda_kernel

   ğŸ“„ arz_model/numerics/time_integration.py
      âœ“ _apply_bounds_kernel
      âœ“ _ode_step_kernel
      âœ“ ssp_rk3_stage_1_kernel
      âœ“ transpose_kernel

ğŸ” Public API method (run/get/set/execute/etc.) (33 functions)
--------------------------------------------------------------------------------

   ğŸ“„ arz_model/benchmarks/benchmark_gpu_optimizations.py
      âœ“ benchmark_simulation_run

   ğŸ“„ arz_model/config/config_factory.py
      âœ“ _create_node_config
      âœ“ _create_segment_config

   ğŸ“„ arz_model/core/parameter_manager.py
      âœ“ get_all
      âœ“ set_local
      âœ“ set_local_dict

   ğŸ“„ arz_model/network/link.py
      âœ“ get_coupling_strength

   ğŸ“„ arz_model/network/network_grid.py
      âœ“ initialize

   ğŸ“„ arz_model/network/topology.py
      âœ“ get_network_diameter

   ğŸ“„ arz_model/numerics/gpu/memory_pool.py
      âœ“ get_all_checkpoints

   ğŸ“„ arz_model/numerics/gpu/utils.py
      âœ“ get_optimal_block_size

   ğŸ“„ arz_model/numerics/reconstruction/weno_gpu.py
      âœ“ _create_weno_flux_kernel

   ğŸ“„ arz_model/numerics/riemann_solvers.py
      âœ“ set_current_time

   ğŸ“„ arz_model/road_network/parser.py
      âœ“ _get_safe_value

   ğŸ“„ arz_model/simulation/execution/network_simulator.py
      âœ“ _initialize_gpu_coupling
      âœ“ _initialize_gpu_pool

   ğŸ“„ arz_model/simulation/runner.py
      âœ“ _create_initial_state
      âœ“ _create_legacy_params_from_config
      âœ“ _initialize_boundary_conditions
      âœ“ _initialize_network
      âœ“ run_until
      âœ“ set_boundary_phases_bulk

   ğŸ“„ arz_model/visualization/data_loader.py
      âœ“ get_all_segments
      âœ“ get_simulated_segment_ids
      âœ“ get_time_array

   ğŸ“„ arz_model/visualization/network_builder.py
      âœ“ create_subgraph_from_simulated
      âœ“ get_graph
      âœ“ get_statistics

   ğŸ“„ arz_model/visualization/network_visualizer.py
      âœ“ _build_segment_to_edge_mapping
      âœ“ _create_enhanced_speed_colormap
      âœ“ create_snapshots
      âœ“ create_static_topology
      âœ“ create_traffic_animation

================================================================================
âŒ CONFIRMED DEAD FUNCTIONS (SAFE TO DELETE)
================================================================================

These functions are NOT called anywhere and have no decorators.
They are likely legacy code that can be safely removed.
================================================================================

ğŸ“Š Total: 83 functions across 33 modules


   ğŸ“„ arz_model/benchmarks/benchmark_gpu_optimizations.py (1 dead functions)
      âŒ print_results





   ğŸ“„ arz_model/core/parameter_manager.py (3 dead functions)
      âŒ has_local
      âŒ list_segments_with_overrides
      âŒ summary

   ğŸ“„ arz_model/core/parameters.py (1 dead functions)
      âŒ _validate_parameters

   ğŸ“„ arz_model/data/enrich_osm_metadata.py (3 dead functions)
      âŒ enrich_corridor_data
      âŒ extract_node_metadata
      âŒ fetch_osm_nodes

   ğŸ“„ arz_model/io/data_manager.py (3 dead functions)
      âŒ load_road_quality_file
      âŒ save_mass_data
      âŒ save_simulation_data

   ğŸ“„ arz_model/network/link.py (1 dead functions)
      âŒ apply_behavioral_coupling

   ğŸ“„ arz_model/network/network_grid.py (5 dead functions)
      âŒ _apply_network_boundary_conditions
      âŒ _prepare_junction_info
      âŒ add_link
      âŒ add_node_from_config
      âŒ add_segment_from_config

   ğŸ“„ arz_model/network/topology.py (3 dead functions)
      âŒ compute_shortest_path
      âŒ find_downstream_segments
      âŒ find_upstream_segments

   ğŸ“„ arz_model/numerics/boundary_conditions.py (1 dead functions)
      âŒ apply_boundary_conditions

   ğŸ“„ arz_model/numerics/cfl.py (5 dead functions)
      âŒ calculate_cfl_dt
      âŒ cfl_condition
      âŒ cfl_condition_gpu_batched
      âŒ cfl_condition_gpu_native
      âŒ compute_adaptive_cfl_with_history

   ğŸ“„ arz_model/numerics/gpu/memory_pool.py (3 dead functions)
      âŒ _allocate_all_arrays
      âŒ release_temp_array
      âŒ update_segment_state_batched

   ğŸ“„ arz_model/numerics/gpu/network_coupling_gpu.py (1 dead functions)
      âŒ _prepare_gpu_topology

   ğŸ“„ arz_model/numerics/gpu/ssp_rk3_cuda.py (1 dead functions)
      âŒ compute_flux_div_shared

   ğŸ“„ arz_model/numerics/gpu/utils.py (3 dead functions)
      âŒ check_cuda_availability
      âŒ cleanup
      âŒ validate_gpu_vs_cpu

   ğŸ“„ arz_model/numerics/gpu/weno_cuda.py (2 dead functions)
      âŒ reconstruct_weno5_gpu
      âŒ reconstruct_weno5_gpu_optimized

   ğŸ“„ arz_model/numerics/logging_utils.py (1 dead functions)
      âŒ should_log

   ğŸ“„ arz_model/numerics/reconstruction/converter.py (2 dead functions)
      âŒ conserved_to_primitives_arr_gpu
      âŒ primitives_to_conserved_arr_gpu

   ğŸ“„ arz_model/numerics/reconstruction/weno_gpu.py (1 dead functions)
      âŒ calculate_spatial_discretization_weno_gpu

   ğŸ“„ arz_model/numerics/riemann_solvers.py (2 dead functions)
      âŒ central_upwind_flux_gpu
      âŒ godunov_flux_upwind

   ğŸ“„ arz_model/numerics/time_integration.py (5 dead functions)
      âŒ _apply_physical_bounds_gpu_in_place
      âŒ batched_strang_splitting_step_gpu_native
      âŒ solve_hyperbolic_step_ssp_rk3_gpu_native
      âŒ solve_ode_step_gpu
      âŒ strang_splitting_step_gpu_native

   ğŸ“„ arz_model/simulation/execution/network_simulator.py (3 dead functions)
      âŒ _log_cfl_diagnostics_throttled
      âŒ _log_diagnostics
      âŒ _log_state

   ğŸ“„ arz_model/simulation/initial_conditions.py (1 dead functions)
      âŒ uniform_initial_condition

   ğŸ“„ arz_model/simulation/runner.py (9 dead functions)
      âŒ _common_initialization
      âŒ _convert_bc_to_legacy
      âŒ _convert_ic_to_legacy
      âŒ _init_from_network_grid
      âŒ _update_bc_from_schedule
      âŒ _validate_gpu_availability
      âŒ _validate_segment_phase
      âŒ animate_results
      âŒ save_results

   ğŸ“„ arz_model/simulation/state/state_manager.py (3 dead functions)
      âŒ advance_time
      âŒ load_checkpoint_from_disk
      âŒ save_checkpoint_to_disk

   ğŸ“„ arz_model/tests/test_gpu_memory_pool.py (1 dead functions)
      âŒ simple_config

   ğŸ“„ arz_model/tests/test_ssp_rk3_fusion.py (1 dead functions)
      âŒ sample_state_random

   ğŸ“„ arz_model/visualization/data_loader.py (1 dead functions)
      âŒ _validate

   ğŸ“„ arz_model/visualization/network_builder.py (1 dead functions)
      âŒ compute_layout

   ğŸ“„ arz_model/visualization/network_visualizer.py (5 dead functions)
      âŒ _draw_base_network
      âŒ _is_edge_active
      âŒ _speed_to_color
      âŒ update
      âŒ update_plot

   ğŸ“„ arz_model/visualization/plotting.py (3 dead functions)
      âŒ plot_convergence_loglog
      âŒ plot_profiles
      âŒ plot_spacetime

   ğŸ“„ arz_model/visualization/uxsim_adapter.py (2 dead functions)
      âŒ update_frame
      âŒ visualize_snapshot

================================================================================
ğŸ” ADDITIONAL INSIGHTS
================================================================================

1. ENTRY POINTS (functions likely called externally):
--------------------------------------------------------------------------------
  run                                      in arz_model/simulation/execution/network_simulator.py - called by 10 functions
  main                                     in arz_model/benchmarks/benchmark_gpu_optimizations.py - called by 4 functions
  run_legacy                               in arz_model/tests/test_ssp_rk3_fusion.py   - called by 2 functions
  run_fused                                in arz_model/tests/test_ssp_rk3_fusion.py   - called by 2 functions
  main                                     in arz_model/data/enrich_osm_metadata.py    - called by 1 functions
  run                                      in arz_model/simulation/runner.py           - called by 1 functions
  main                                     in arz_model/main_network_builder.py        - called by 0 functions
  test_dt_min_protection_allows_stable_runs in arz_model/tests/test_dt_min_protection.py - called by 0 functions
  main                                     in arz_model/main_network_simulation.py     - called by 0 functions
  run_until                                in arz_model/simulation/runner.py           - called by 0 functions
  test_simulation_runs_end_to_end_on_gpu   in arz_model/tests/test_gpu_only_integration.py - called by 0 functions
  benchmark_simulation_run                 in arz_model/benchmarks/benchmark_gpu_optimizations.py - called by 0 functions


2. HUB FUNCTIONS (called by many others):
--------------------------------------------------------------------------------
  __init__                                 (arz_model/config/config_factory.py      ) - called by 24 functions
  cleanup                                  (arz_model/numerics/gpu/ssp_rk3_cuda.py  ) - called by 18 functions
  integrate_ssp_rk3_gpu                    (arz_model/numerics/gpu/ssp_rk3_cuda.py  ) - called by 17 functions
  clear                                    (arz_model/config/network_config_cache.py) - called by 15 functions
  from_config                              (arz_model/network/network_grid.py       ) - called by 13 functions
  get                                      (arz_model/core/parameter_manager.py     ) - called by 13 functions
  run                                      (arz_model/simulation/execution/network_simulator.py) - called by 10 functions
  __repr__                                 (arz_model/config/physics_config.py      ) - called by 10 functions
  info                                     (arz_model/simulation/logging/simulation_logger.py) - called by 10 functions
  load                                     (arz_model/config/network_config_cache.py) - called by 10 functions
  debug                                    (arz_model/simulation/logging/simulation_logger.py) - called by 8 functions
  initialize_segment_state                 (arz_model/numerics/gpu/memory_pool.py   ) - called by 8 functions
  checkpoint_to_cpu                        (arz_model/numerics/gpu/memory_pool.py   ) - called by 8 functions
  get_segment_state                        (arz_model/numerics/gpu/memory_pool.py   ) - called by 7 functions
  step                                     (arz_model/network/network_grid.py       ) - called by 6 functions
  create_test_config                       (arz_model/tests/test_gpu_only_integration.py) - called by 5 functions
  load_topology                            (arz_model/visualization/network_builder.py) - called by 5 functions
  main                                     (arz_model/benchmarks/benchmark_gpu_optimizations.py) - called by 4 functions
  compute_fingerprint                      (arz_model/config/network_config_cache.py) - called by 4 functions
  __str__                                  (arz_model/core/parameters.py            ) - called by 4 functions
  get_boundary_states                      (arz_model/network/node.py               ) - called by 4 functions
  get_outgoing_capacities                  (arz_model/network/node.py               ) - called by 4 functions
  _get_gpu_memory_usage                    (arz_model/numerics/gpu/memory_pool.py   ) - called by 4 functions
  synchronize_all_streams                  (arz_model/numerics/gpu/memory_pool.py   ) - called by 4 functions
  get_stream                               (arz_model/numerics/gpu/memory_pool.py   ) - called by 4 functions
  central_upwind_flux_device               (arz_model/numerics/gpu/ssp_rk3_cuda.py  ) - called by 4 functions
  get_memory_stats                         (arz_model/numerics/gpu/memory_pool.py   ) - called by 4 functions
  calculate_spatial_discretization_weno_gpu_native (arz_model/numerics/reconstruction/weno_gpu.py) - called by 4 functions
  create_victoria_island_config            (arz_model/config/config_factory.py      ) - called by 4 functions
  __enter__                                (arz_model/numerics/gpu/memory_pool.py   ) - called by 3 functions

================================================================================
ğŸ“‹ SUMMARY
================================================================================

Architecture Analysis Complete! (v3.1)

Total Functions: 414
  â”œâ”€ Called at least once: 187
  â”œâ”€ Never called (total): 290
  â”‚   â”œâ”€ Confirmed dead: 83
  â”‚   â””â”€ Suspected false positives: 116
  â””â”€ With decorators: 63

Special Functions Detected:
  â”œâ”€ Pytest tests: 56
  â”œâ”€ Pytest fixtures: 0
  â”œâ”€ Pydantic validators: 12
  â”œâ”€ Property methods: 0
  â”œâ”€ Class methods: 10
  â”œâ”€ Static methods: 1
  â””â”€ Main entry points: 38

Recommendations:
  âœ“ DO NOT delete functions in "SUSPECTED FALSE POSITIVES"
  âœ“ SAFE to delete functions in "CONFIRMED DEAD FUNCTIONS"
  âœ“ Review entry points and hub functions for refactoring opportunities

================================================================================
âœ… Analysis saved to: arz_model/architecture_analysis_v3.txt
================================================================================
