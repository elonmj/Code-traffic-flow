2025-10-15 13:27:09 - INFO - _setup_debug_logging:155 - ================================================================================
2025-10-15 13:27:09 - INFO - _setup_debug_logging:156 - DEBUG LOGGING INITIALIZED
2025-10-15 13:27:09 - INFO - _setup_debug_logging:157 - Log file: validation_output/results/local_test/section_7_6_rl_performance/debug.log
2025-10-15 13:27:09 - INFO - _setup_debug_logging:158 - Quick test mode: True
2025-10-15 13:27:09 - INFO - _setup_debug_logging:159 - ================================================================================
2025-10-15 13:27:09 - INFO - train_rl_agent:1025 - ================================================================================
2025-10-15 13:27:09 - INFO - train_rl_agent:1026 - Training RL agent (Code_RL design) for scenario: traffic_light_control
2025-10-15 13:27:09 - INFO - train_rl_agent:1027 -   - Device: gpu
2025-10-15 13:27:09 - INFO - train_rl_agent:1028 -   - Total timesteps: 100
2025-10-15 13:27:09 - INFO - train_rl_agent:1029 -   - Checkpoint freq: 50
2025-10-15 13:27:09 - INFO - train_rl_agent:1030 -   - Hyperparameters: CODE_RL_HYPERPARAMETERS (lr=1e-3, batch=32)
2025-10-15 13:27:09 - INFO - train_rl_agent:1031 - ================================================================================
2025-10-15 13:27:09 - INFO - _get_project_root:168 - [PATH] Project root resolved: /kaggle/working/Code-traffic-flow
2025-10-15 13:27:09 - INFO - _get_checkpoint_dir:227 - [PATH] Checkpoint directory: /kaggle/working/Code-traffic-flow/validation_ch7/checkpoints/section_7_6
2025-10-15 13:27:09 - INFO - _get_checkpoint_dir:228 - [PATH] Checkpoint directory exists: True
2025-10-15 13:27:09 - INFO - _get_checkpoint_dir:231 - [PATH] Found 2 existing checkpoints
2025-10-15 13:27:09 - INFO - _create_scenario_config:602 - [SCENARIO] Created using Code_RL: traffic_light_control.yml
2025-10-15 13:27:09 - INFO - _create_scenario_config:603 -   Context: Victoria Island Lagos
2025-10-15 13:27:09 - INFO - _create_scenario_config:604 -   Max densities: 250/120 veh/km
2025-10-15 13:27:09 - INFO - _create_scenario_config:605 -   Free speeds: 32/28 km/h
2025-10-15 13:27:09 - INFO - _get_project_root:168 - [PATH] Project root resolved: /kaggle/working/Code-traffic-flow
2025-10-15 13:27:09 - INFO - _get_cache_dir:245 - [CACHE] Directory: /kaggle/working/Code-traffic-flow/validation_ch7/cache/section_7_6
2025-10-15 13:27:09 - INFO - _compute_config_hash:258 - [CACHE] Config hash: 515c5ce5
2025-10-15 13:27:09 - INFO - _load_rl_cache:536 - [CACHE RL] No cache found for traffic_light_control with config 515c5ce5
2025-10-15 13:27:10 - INFO - _compute_config_hash:258 - [CACHE] Config hash: 515c5ce5
2025-10-15 13:27:10 - WARNING - _validate_checkpoint_config:288 - [CHECKPOINT] No config_hash in traffic_light_control_checkpoint_100_steps.zip - treating as incompatible
2025-10-15 13:27:10 - INFO - _archive_incompatible_checkpoint:323 - [CHECKPOINT] Archived incompatible checkpoint to /kaggle/working/Code-traffic-flow/validation_ch7/checkpoints/section_7_6/archived/traffic_light_control_checkpoint_100_steps_CONFIG_LEGACY.zip
2025-10-15 13:27:10 - INFO - _archive_incompatible_checkpoint:323 - [CHECKPOINT] Archived incompatible checkpoint to /kaggle/working/Code-traffic-flow/validation_ch7/checkpoints/section_7_6/archived/traffic_light_control_checkpoint_50_steps_CONFIG_LEGACY.zip
2025-10-15 13:27:15 - INFO - _compute_config_hash:258 - [CACHE] Config hash: 515c5ce5
2025-10-15 13:28:01 - INFO - _get_project_root:168 - [PATH] Project root resolved: /kaggle/working/Code-traffic-flow
2025-10-15 13:28:01 - INFO - _get_cache_dir:245 - [CACHE] Directory: /kaggle/working/Code-traffic-flow/validation_ch7/cache/section_7_6
2025-10-15 13:28:01 - INFO - _compute_config_hash:258 - [CACHE] Config hash: 515c5ce5
2025-10-15 13:28:01 - INFO - _save_rl_cache:516 - [CACHE RL] Saved metadata to traffic_light_control_515c5ce5_rl_cache.pkl
2025-10-15 13:28:01 - INFO - run_performance_comparison:1239 - ================================================================================
2025-10-15 13:28:01 - INFO - run_performance_comparison:1240 - Starting run_performance_comparison for scenario: traffic_light_control
2025-10-15 13:28:01 - INFO - run_performance_comparison:1241 - Device: gpu
2025-10-15 13:28:01 - INFO - run_performance_comparison:1242 - ================================================================================
2025-10-15 13:28:01 - INFO - _create_scenario_config:602 - [SCENARIO] Created using Code_RL: traffic_light_control.yml
2025-10-15 13:28:01 - INFO - _create_scenario_config:603 -   Context: Victoria Island Lagos
2025-10-15 13:28:01 - INFO - _create_scenario_config:604 -   Max densities: 250/120 veh/km
2025-10-15 13:28:01 - INFO - _create_scenario_config:605 -   Free speeds: 32/28 km/h
2025-10-15 13:28:01 - INFO - _get_project_root:168 - [PATH] Project root resolved: /kaggle/working/Code-traffic-flow
2025-10-15 13:28:01 - INFO - _get_cache_dir:245 - [CACHE] Directory: /kaggle/working/Code-traffic-flow/validation_ch7/cache/section_7_6
2025-10-15 13:28:01 - INFO - _load_baseline_cache:405 - [CACHE BASELINE] Found universal cache: 40 steps (duration=600.0s)
2025-10-15 13:28:01 - INFO - _load_baseline_cache:406 - [CACHE BASELINE] Required: 41 steps (duration=600.0s)
2025-10-15 13:28:01 - INFO - _extend_baseline_cache:440 - [CACHE] Extending cache additively: 40 steps â†’ target 41 steps
2025-10-15 13:28:01 - INFO - run_control_simulation:703 - ================================================================================
2025-10-15 13:28:01 - INFO - run_control_simulation:704 - Starting run_control_simulation:
2025-10-15 13:28:01 - INFO - run_control_simulation:705 -   - scenario_path: validation_output/results/local_test/section_7_6_rl_performance/data/scenarios/traffic_light_control.yml
2025-10-15 13:28:01 - INFO - run_control_simulation:706 -   - duration: 0.0s
2025-10-15 13:28:01 - INFO - run_control_simulation:707 -   - control_interval: 15.0s
2025-10-15 13:28:01 - INFO - run_control_simulation:708 -   - device: gpu
2025-10-15 13:28:01 - INFO - run_control_simulation:709 -   - controller: BaselineController
2025-10-15 13:28:01 - INFO - run_control_simulation:710 -   - max_control_steps: 1
2025-10-15 13:28:01 - INFO - run_control_simulation:711 - ================================================================================
2025-10-15 13:28:01 - INFO - run_control_simulation:716 - Creating TrafficSignalEnvDirect instance...
2025-10-15 13:28:01 - INFO - run_control_simulation:731 - TrafficSignalEnvDirect created successfully
2025-10-15 13:28:01 - INFO - run_control_simulation:732 -   SENSITIVITY FIX: Observation segments [3-8] ~ 30-80m from boundary
2025-10-15 13:28:01 - INFO - run_control_simulation:748 - Calling env.reset()...
2025-10-15 13:28:01 - INFO - run_control_simulation:750 - env.reset() successful - obs shape: (26,), info: {'episode_step': 0, 'simulation_time': 0.0, 'current_phase': 0}
2025-10-15 13:28:01 - INFO - run_control_simulation:755 - [RESUME] Setting initial state from cache (shape=(4, 104))
2025-10-15 13:28:01 - ERROR - run_control_simulation:774 - Environment reset failed: 'DeviceNDArray' object has no attribute 'copy_from_host'
Traceback (most recent call last):
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 759, in run_control_simulation
    env.runner.d_U.copy_from_host(initial_state)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'DeviceNDArray' object has no attribute 'copy_from_host'
2025-10-15 13:28:01 - ERROR - run_performance_comparison:1392 - Performance comparison failed for traffic_light_control: cannot access local variable 'traceback' where it is not associated with a value
Traceback (most recent call last):
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 759, in run_control_simulation
    env.runner.d_U.copy_from_host(initial_state)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'DeviceNDArray' object has no attribute 'copy_from_host'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 1276, in run_performance_comparison
    baseline_states = self._extend_baseline_cache(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 453, in _extend_baseline_cache
    extension_states, _ = self.run_control_simulation(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 776, in run_control_simulation
    traceback.print_exc()
    ^^^^^^^^^
UnboundLocalError: cannot access local variable 'traceback' where it is not associated with a value
