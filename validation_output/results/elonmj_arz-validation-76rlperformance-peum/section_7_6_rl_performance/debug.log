2025-10-15 13:45:30 - INFO - _setup_debug_logging:155 - ================================================================================
2025-10-15 13:45:30 - INFO - _setup_debug_logging:156 - DEBUG LOGGING INITIALIZED
2025-10-15 13:45:30 - INFO - _setup_debug_logging:157 - Log file: validation_output/results/local_test/section_7_6_rl_performance/debug.log
2025-10-15 13:45:30 - INFO - _setup_debug_logging:158 - Quick test mode: True
2025-10-15 13:45:30 - INFO - _setup_debug_logging:159 - ================================================================================
2025-10-15 13:45:30 - INFO - train_rl_agent:1027 - ================================================================================
2025-10-15 13:45:30 - INFO - train_rl_agent:1028 - Training RL agent (Code_RL design) for scenario: traffic_light_control
2025-10-15 13:45:30 - INFO - train_rl_agent:1029 -   - Device: gpu
2025-10-15 13:45:30 - INFO - train_rl_agent:1030 -   - Total timesteps: 100
2025-10-15 13:45:30 - INFO - train_rl_agent:1031 -   - Checkpoint freq: 50
2025-10-15 13:45:30 - INFO - train_rl_agent:1032 -   - Hyperparameters: CODE_RL_HYPERPARAMETERS (lr=1e-3, batch=32)
2025-10-15 13:45:30 - INFO - train_rl_agent:1033 - ================================================================================
2025-10-15 13:45:30 - INFO - _get_project_root:168 - [PATH] Project root resolved: /kaggle/working/Code-traffic-flow
2025-10-15 13:45:30 - INFO - _get_checkpoint_dir:227 - [PATH] Checkpoint directory: /kaggle/working/Code-traffic-flow/validation_ch7/checkpoints/section_7_6
2025-10-15 13:45:30 - INFO - _get_checkpoint_dir:228 - [PATH] Checkpoint directory exists: True
2025-10-15 13:45:30 - INFO - _get_checkpoint_dir:231 - [PATH] Found 2 existing checkpoints
2025-10-15 13:45:30 - INFO - _create_scenario_config:602 - [SCENARIO] Created using Code_RL: traffic_light_control.yml
2025-10-15 13:45:30 - INFO - _create_scenario_config:603 -   Context: Victoria Island Lagos
2025-10-15 13:45:30 - INFO - _create_scenario_config:604 -   Max densities: 250/120 veh/km
2025-10-15 13:45:30 - INFO - _create_scenario_config:605 -   Free speeds: 32/28 km/h
2025-10-15 13:45:30 - INFO - _get_project_root:168 - [PATH] Project root resolved: /kaggle/working/Code-traffic-flow
2025-10-15 13:45:30 - INFO - _get_cache_dir:245 - [CACHE] Directory: /kaggle/working/Code-traffic-flow/validation_ch7/cache/section_7_6
2025-10-15 13:45:30 - INFO - _compute_config_hash:258 - [CACHE] Config hash: 515c5ce5
2025-10-15 13:45:30 - INFO - _load_rl_cache:536 - [CACHE RL] No cache found for traffic_light_control with config 515c5ce5
2025-10-15 13:45:31 - INFO - _compute_config_hash:258 - [CACHE] Config hash: 515c5ce5
2025-10-15 13:45:31 - WARNING - _validate_checkpoint_config:288 - [CHECKPOINT] No config_hash in traffic_light_control_checkpoint_100_steps.zip - treating as incompatible
2025-10-15 13:45:31 - INFO - _archive_incompatible_checkpoint:323 - [CHECKPOINT] Archived incompatible checkpoint to /kaggle/working/Code-traffic-flow/validation_ch7/checkpoints/section_7_6/archived/traffic_light_control_checkpoint_50_steps_CONFIG_LEGACY.zip
2025-10-15 13:45:31 - INFO - _archive_incompatible_checkpoint:323 - [CHECKPOINT] Archived incompatible checkpoint to /kaggle/working/Code-traffic-flow/validation_ch7/checkpoints/section_7_6/archived/traffic_light_control_checkpoint_100_steps_CONFIG_LEGACY.zip
2025-10-15 13:45:36 - INFO - _compute_config_hash:258 - [CACHE] Config hash: 515c5ce5
2025-10-15 13:46:24 - INFO - _get_project_root:168 - [PATH] Project root resolved: /kaggle/working/Code-traffic-flow
2025-10-15 13:46:24 - INFO - _get_cache_dir:245 - [CACHE] Directory: /kaggle/working/Code-traffic-flow/validation_ch7/cache/section_7_6
2025-10-15 13:46:24 - INFO - _compute_config_hash:258 - [CACHE] Config hash: 515c5ce5
2025-10-15 13:46:24 - INFO - _save_rl_cache:516 - [CACHE RL] Saved metadata to traffic_light_control_515c5ce5_rl_cache.pkl
2025-10-15 13:46:24 - INFO - run_performance_comparison:1241 - ================================================================================
2025-10-15 13:46:24 - INFO - run_performance_comparison:1242 - Starting run_performance_comparison for scenario: traffic_light_control
2025-10-15 13:46:24 - INFO - run_performance_comparison:1243 - Device: gpu
2025-10-15 13:46:24 - INFO - run_performance_comparison:1244 - ================================================================================
2025-10-15 13:46:24 - INFO - _create_scenario_config:602 - [SCENARIO] Created using Code_RL: traffic_light_control.yml
2025-10-15 13:46:24 - INFO - _create_scenario_config:603 -   Context: Victoria Island Lagos
2025-10-15 13:46:24 - INFO - _create_scenario_config:604 -   Max densities: 250/120 veh/km
2025-10-15 13:46:24 - INFO - _create_scenario_config:605 -   Free speeds: 32/28 km/h
2025-10-15 13:46:24 - INFO - _get_project_root:168 - [PATH] Project root resolved: /kaggle/working/Code-traffic-flow
2025-10-15 13:46:24 - INFO - _get_cache_dir:245 - [CACHE] Directory: /kaggle/working/Code-traffic-flow/validation_ch7/cache/section_7_6
2025-10-15 13:46:24 - INFO - _load_baseline_cache:405 - [CACHE BASELINE] Found universal cache: 40 steps (duration=600.0s)
2025-10-15 13:46:24 - INFO - _load_baseline_cache:406 - [CACHE BASELINE] Required: 41 steps (duration=600.0s)
2025-10-15 13:46:24 - INFO - _extend_baseline_cache:440 - [CACHE] Extending cache additively: 40 steps â†’ target 41 steps
2025-10-15 13:46:24 - INFO - run_control_simulation:703 - ================================================================================
2025-10-15 13:46:24 - INFO - run_control_simulation:704 - Starting run_control_simulation:
2025-10-15 13:46:24 - INFO - run_control_simulation:705 -   - scenario_path: validation_output/results/local_test/section_7_6_rl_performance/data/scenarios/traffic_light_control.yml
2025-10-15 13:46:24 - INFO - run_control_simulation:706 -   - duration: 0.0s
2025-10-15 13:46:24 - INFO - run_control_simulation:707 -   - control_interval: 15.0s
2025-10-15 13:46:24 - INFO - run_control_simulation:708 -   - device: gpu
2025-10-15 13:46:24 - INFO - run_control_simulation:709 -   - controller: BaselineController
2025-10-15 13:46:24 - INFO - run_control_simulation:710 -   - max_control_steps: 1
2025-10-15 13:46:24 - INFO - run_control_simulation:711 - ================================================================================
2025-10-15 13:46:24 - INFO - run_control_simulation:716 - Creating TrafficSignalEnvDirect instance...
2025-10-15 13:46:24 - INFO - run_control_simulation:731 - TrafficSignalEnvDirect created successfully
2025-10-15 13:46:24 - INFO - run_control_simulation:732 -   SENSITIVITY FIX: Observation segments [3-8] ~ 30-80m from boundary
2025-10-15 13:46:24 - INFO - run_control_simulation:748 - Calling env.reset()...
2025-10-15 13:46:24 - INFO - run_control_simulation:750 - env.reset() successful - obs shape: (26,), info: {'episode_step': 0, 'simulation_time': 0.0, 'current_phase': 0}
2025-10-15 13:46:24 - INFO - run_control_simulation:755 - [RESUME] Setting initial state from cache (shape=(4, 104))
2025-10-15 13:46:24 - INFO - run_control_simulation:765 - [RESUME] Initial state overridden successfully
2025-10-15 13:46:24 - INFO - run_control_simulation:769 - INITIAL STATE shape: (4, 104), dtype: float64
2025-10-15 13:46:24 - INFO - run_control_simulation:770 - INITIAL STATE statistics: mean=7.933704e+00, std=8.178274e+00, min=2.677855e-03, max=1.772026e+01
2025-10-15 13:46:24 - INFO - run_control_simulation:786 - Starting simulation loop - max 1 control steps
2025-10-15 13:46:24 - INFO - run_control_simulation:895 - 
  [BASELINE] [SIMULATION COMPLETED] Summary:
    - Controller type: BASELINE
    - Total control steps: 0
    - Total reward: 0.00
    - Avg step time: 0.000s (device=gpu)
    - Simulated time: 0.0s / 0.0s
    - Wallclock time: 0.0s
    - Speed ratio: 0.00x real-time

2025-10-15 13:46:24 - INFO - run_control_simulation:896 - Returning 0 state snapshots
2025-10-15 13:46:24 - INFO - _get_project_root:168 - [PATH] Project root resolved: /kaggle/working/Code-traffic-flow
2025-10-15 13:46:24 - INFO - _get_cache_dir:245 - [CACHE] Directory: /kaggle/working/Code-traffic-flow/validation_ch7/cache/section_7_6
2025-10-15 13:46:24 - INFO - _save_baseline_cache:368 - [CACHE BASELINE] Saved 40 states to traffic_light_control_baseline_cache.pkl
2025-10-15 13:46:24 - INFO - evaluate_traffic_performance:919 - Evaluating performance with 40 state snapshots
2025-10-15 13:46:24 - INFO - evaluate_traffic_performance:920 -   HASH CHECK - first=536113197116232766, last=-4963031644006951120
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 0: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - INFO - evaluate_traffic_performance:929 - First state sample - rho_m[10:15]=[0.12099642 0.12250802 0.12360909 0.12428391 0.12465821], w_m[10:15]=[7.2740965  7.26930779 7.26499621 7.26265481 7.26146517]
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 1: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 2: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 3: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 4: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 5: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 6: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 7: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 8: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 9: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 10: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 11: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 12: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 13: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 14: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 15: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 16: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 17: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 18: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 19: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 20: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 21: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 22: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 23: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 24: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 25: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 26: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 27: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 28: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 29: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 30: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 31: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 32: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 33: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 34: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 35: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 36: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 37: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 38: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - DEBUG - evaluate_traffic_performance:926 - State 39: shape=(4, 104), dtype=float64
2025-10-15 13:46:24 - INFO - evaluate_traffic_performance:931 - Last state sample - rho_m[10:15]=[0.02230073 0.02229694 0.02229543 0.02229482 0.02229456], w_m[10:15]=[17.7152503  17.71823457 17.71941674 17.71989863 17.72010112]
2025-10-15 13:46:24 - INFO - evaluate_traffic_performance:985 - Calculated metrics: flow=28.290255, efficiency=4.526441, delay=-174.08s
2025-10-15 13:46:24 - INFO - run_control_simulation:703 - ================================================================================
2025-10-15 13:46:24 - INFO - run_control_simulation:704 - Starting run_control_simulation:
2025-10-15 13:46:24 - INFO - run_control_simulation:705 -   - scenario_path: validation_output/results/local_test/section_7_6_rl_performance/data/scenarios/traffic_light_control.yml
2025-10-15 13:46:24 - INFO - run_control_simulation:706 -   - duration: 600.0s
2025-10-15 13:46:24 - INFO - run_control_simulation:707 -   - control_interval: 15.0s
2025-10-15 13:46:24 - INFO - run_control_simulation:708 -   - device: gpu
2025-10-15 13:46:24 - INFO - run_control_simulation:709 -   - controller: RLController
2025-10-15 13:46:24 - INFO - run_control_simulation:710 -   - max_control_steps: 41
2025-10-15 13:46:24 - INFO - run_control_simulation:711 - ================================================================================
2025-10-15 13:46:24 - INFO - run_control_simulation:716 - Creating TrafficSignalEnvDirect instance...
2025-10-15 13:46:24 - INFO - run_control_simulation:731 - TrafficSignalEnvDirect created successfully
2025-10-15 13:46:24 - INFO - run_control_simulation:732 -   SENSITIVITY FIX: Observation segments [3-8] ~ 30-80m from boundary
2025-10-15 13:46:24 - INFO - run_control_simulation:748 - Calling env.reset()...
2025-10-15 13:46:24 - INFO - run_control_simulation:750 - env.reset() successful - obs shape: (26,), info: {'episode_step': 0, 'simulation_time': 0.0, 'current_phase': 0}
2025-10-15 13:46:24 - INFO - run_control_simulation:769 - INITIAL STATE shape: (4, 104), dtype: float64
2025-10-15 13:46:24 - ERROR - run_control_simulation:774 - Environment reset failed: 'NoneType' object has no attribute 'mean'
Traceback (most recent call last):
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 770, in run_control_simulation
    self.debug_logger.info(f"INITIAL STATE statistics: mean={initial_state.mean():.6e}, std={initial_state.std():.6e}, min={initial_state.min():.6e}, max={initial_state.max():.6e}")
                                                             ^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'mean'
2025-10-15 13:46:24 - ERROR - run_performance_comparison:1394 - Performance comparison failed for traffic_light_control: cannot access local variable 'traceback' where it is not associated with a value
Traceback (most recent call last):
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 770, in run_control_simulation
    self.debug_logger.info(f"INITIAL STATE statistics: mean={initial_state.mean():.6e}, std={initial_state.std():.6e}, min={initial_state.min():.6e}, max={initial_state.max():.6e}")
                                                             ^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'mean'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 1326, in run_performance_comparison
    rl_states, _ = self.run_control_simulation(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 776, in run_control_simulation
    traceback.print_exc()
    ^^^^^^^^^
UnboundLocalError: cannot access local variable 'traceback' where it is not associated with a value
