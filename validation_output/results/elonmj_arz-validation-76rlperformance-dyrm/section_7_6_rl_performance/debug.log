2025-10-11 11:50:00 - INFO - _setup_debug_logging:119 - ================================================================================
2025-10-11 11:50:00 - INFO - _setup_debug_logging:120 - DEBUG LOGGING INITIALIZED
2025-10-11 11:50:00 - INFO - _setup_debug_logging:121 - Log file: validation_output/results/local_test/section_7_6_rl_performance/debug.log
2025-10-11 11:50:00 - INFO - _setup_debug_logging:122 - Quick test mode: True
2025-10-11 11:50:00 - INFO - _setup_debug_logging:123 - ================================================================================
2025-10-11 11:50:01 - INFO - train_rl_agent:580 - ================================================================================
2025-10-11 11:50:01 - INFO - train_rl_agent:581 - Starting train_rl_agent for scenario: traffic_light_control
2025-10-11 11:50:01 - INFO - train_rl_agent:582 -   - Device: gpu
2025-10-11 11:50:01 - INFO - train_rl_agent:583 -   - Total timesteps: 100
2025-10-11 11:50:01 - INFO - train_rl_agent:584 -   - Episode max time: 120.0s
2025-10-11 11:50:01 - INFO - train_rl_agent:585 -   - Checkpoint frequency: 50
2025-10-11 11:50:01 - INFO - train_rl_agent:586 - ================================================================================
2025-10-11 11:50:01 - INFO - _create_scenario_config:214 - Created scenario config: traffic_light_control.yml
2025-10-11 11:50:01 - INFO - _create_scenario_config:215 -   BUG #10 FIX: Domain=1km, UNIFORM congestion IC (no shock)
2025-10-11 11:50:01 - INFO - _create_scenario_config:216 -   BUG #14 FIX: Initial=40.0/50.0 veh/km, Inflow=120.0/150.0 veh/km
2025-10-11 11:50:01 - INFO - _create_scenario_config:217 -   Initial velocity: w_m=15.0 m/s, w_c=13.0 m/s
2025-10-11 11:50:01 - INFO - _create_scenario_config:218 -   Inflow velocity: w_m=8.0 m/s, w_c=6.0 m/s
2025-10-11 11:50:08 - ERROR - train_rl_agent:710 - Training failed for traffic_light_control: CFL Check (GPU): Extremely large max_abs_lambda detected (1.1400e+06 m/s), stopping simulation.
Traceback (most recent call last):
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 693, in train_rl_agent
    model.learn(
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/ppo/ppo.py", line 308, in learn
    return super().learn(
           ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/on_policy_algorithm.py", line 259, in learn
    continue_training = self.collect_rollouts(self.env, callback, self.rollout_buffer, n_rollout_steps=self.n_steps)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/on_policy_algorithm.py", line 178, in collect_rollouts
    new_obs, rewards, dones, infos = env.step(clipped_actions)
                                     ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/vec_env/base_vec_env.py", line 197, in step
    return self.step_wait()
           ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/vec_env/dummy_vec_env.py", line 58, in step_wait
    obs, self.buf_rews[env_idx], terminated, truncated, self.buf_infos[env_idx] = self.envs[env_idx].step(
                                                                                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/monitor.py", line 94, in step
    observation, reward, terminated, truncated, info = self.env.step(action)
                                                       ^^^^^^^^^^^^^^^^^^^^^
  File "/kaggle/working/Code-traffic-flow/Code_RL/src/env/traffic_signal_env_direct.py", line 238, in step
    self.runner.run(t_final=target_time, output_dt=self.decision_interval)
  File "/kaggle/working/Code-traffic-flow/arz_model/simulation/runner.py", line 522, in run
    dt = cfl.calculate_cfl_dt(current_U, self.grid, self.params)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/kaggle/working/Code-traffic-flow/arz_model/numerics/cfl.py", line 175, in calculate_cfl_dt
    raise ValueError(f"CFL Check (GPU): Extremely large max_abs_lambda detected ({max_abs_lambda:.4e} m/s), stopping simulation.")
ValueError: CFL Check (GPU): Extremely large max_abs_lambda detected (1.1400e+06 m/s), stopping simulation.
2025-10-11 11:50:08 - INFO - run_performance_comparison:718 - ================================================================================
2025-10-11 11:50:08 - INFO - run_performance_comparison:719 - Starting run_performance_comparison for scenario: traffic_light_control
2025-10-11 11:50:08 - INFO - run_performance_comparison:720 - Device: gpu
2025-10-11 11:50:08 - INFO - run_performance_comparison:721 - ================================================================================
2025-10-11 11:50:08 - INFO - run_performance_comparison:722 - ================================================================================
2025-10-11 11:50:08 - INFO - run_performance_comparison:723 - Starting run_performance_comparison for scenario: traffic_light_control
2025-10-11 11:50:08 - INFO - run_performance_comparison:724 - Device: gpu
2025-10-11 11:50:08 - INFO - run_performance_comparison:725 - ================================================================================
2025-10-11 11:50:08 - INFO - _create_scenario_config:214 - Created scenario config: traffic_light_control.yml
2025-10-11 11:50:08 - INFO - _create_scenario_config:215 -   BUG #10 FIX: Domain=1km, UNIFORM congestion IC (no shock)
2025-10-11 11:50:08 - INFO - _create_scenario_config:216 -   BUG #14 FIX: Initial=40.0/50.0 veh/km, Inflow=120.0/150.0 veh/km
2025-10-11 11:50:08 - INFO - _create_scenario_config:217 -   Initial velocity: w_m=15.0 m/s, w_c=13.0 m/s
2025-10-11 11:50:08 - INFO - _create_scenario_config:218 -   Inflow velocity: w_m=8.0 m/s, w_c=6.0 m/s
2025-10-11 11:50:08 - INFO - run_control_simulation:298 - ================================================================================
2025-10-11 11:50:08 - INFO - run_control_simulation:299 - Starting run_control_simulation:
2025-10-11 11:50:08 - INFO - run_control_simulation:300 -   - scenario_path: validation_output/results/local_test/section_7_6_rl_performance/data/scenarios/traffic_light_control.yml
2025-10-11 11:50:08 - INFO - run_control_simulation:301 -   - duration: 600.0s
2025-10-11 11:50:08 - INFO - run_control_simulation:302 -   - control_interval: 60.0s
2025-10-11 11:50:08 - INFO - run_control_simulation:303 -   - device: gpu
2025-10-11 11:50:08 - INFO - run_control_simulation:304 -   - controller: BaselineController
2025-10-11 11:50:08 - INFO - run_control_simulation:305 -   - max_control_steps: 11
2025-10-11 11:50:08 - INFO - run_control_simulation:306 - ================================================================================
2025-10-11 11:50:08 - INFO - run_control_simulation:311 - Creating TrafficSignalEnvDirect instance...
2025-10-11 11:50:08 - INFO - run_control_simulation:326 - TrafficSignalEnvDirect created successfully
2025-10-11 11:50:08 - INFO - run_control_simulation:327 -   SENSITIVITY FIX: Observation segments [3-8] ~ 30-80m from boundary
2025-10-11 11:50:08 - INFO - run_control_simulation:343 - Calling env.reset()...
2025-10-11 11:50:08 - INFO - run_control_simulation:345 - env.reset() successful - obs shape: (26,), info: {'episode_step': 0, 'simulation_time': 0.0, 'current_phase': 0}
2025-10-11 11:50:08 - INFO - run_control_simulation:349 - INITIAL STATE shape: (4, 104), dtype: float64
2025-10-11 11:50:08 - INFO - run_control_simulation:350 - INITIAL STATE statistics: mean=2.895269e+01, std=1.623802e+01, min=1.200000e-01, max=5.000000e+01
2025-10-11 11:50:08 - INFO - run_control_simulation:366 - Starting simulation loop - max 11 control steps
2025-10-11 11:50:08 - INFO - run_control_simulation:380 - ================================================================================
2025-10-11 11:50:08 - INFO - run_control_simulation:381 - STEP 0 START:
2025-10-11 11:50:08 - INFO - run_control_simulation:382 -   Controller: BaselineController
2025-10-11 11:50:08 - INFO - run_control_simulation:383 -   Action: 1.000000
2025-10-11 11:50:08 - INFO - run_control_simulation:384 -   Simulation time: 0.00s
2025-10-11 11:50:08 - ERROR - run_control_simulation:401 - env.step() failed at step 0: CFL Check (GPU): Extremely large max_abs_lambda detected (1.1400e+06 m/s), stopping simulation.
Traceback (most recent call last):
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 393, in run_control_simulation
    obs, reward, terminated, truncated, info = env.step(action)
                                               ^^^^^^^^^^^^^^^^
  File "/kaggle/working/Code-traffic-flow/Code_RL/src/env/traffic_signal_env_direct.py", line 238, in step
    self.runner.run(t_final=target_time, output_dt=self.decision_interval)
  File "/kaggle/working/Code-traffic-flow/arz_model/simulation/runner.py", line 522, in run
    dt = cfl.calculate_cfl_dt(current_U, self.grid, self.params)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/kaggle/working/Code-traffic-flow/arz_model/numerics/cfl.py", line 175, in calculate_cfl_dt
    raise ValueError(f"CFL Check (GPU): Extremely large max_abs_lambda detected ({max_abs_lambda:.4e} m/s), stopping simulation.")
ValueError: CFL Check (GPU): Extremely large max_abs_lambda detected (1.1400e+06 m/s), stopping simulation.
