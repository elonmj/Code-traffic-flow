2025-10-09 22:35:43 - INFO - _setup_debug_logging:119 - ================================================================================
2025-10-09 22:35:43 - INFO - _setup_debug_logging:120 - DEBUG LOGGING INITIALIZED
2025-10-09 22:35:43 - INFO - _setup_debug_logging:121 - Log file: validation_output/results/local_test/section_7_6_rl_performance/debug.log
2025-10-09 22:35:43 - INFO - _setup_debug_logging:122 - Quick test mode: False
2025-10-09 22:35:43 - INFO - _setup_debug_logging:123 - ================================================================================
2025-10-09 22:35:43 - INFO - train_rl_agent:549 - ================================================================================
2025-10-09 22:35:43 - INFO - train_rl_agent:550 - Starting train_rl_agent for scenario: traffic_light_control
2025-10-09 22:35:43 - INFO - train_rl_agent:551 -   - Device: gpu
2025-10-09 22:35:43 - INFO - train_rl_agent:552 -   - Total timesteps: 5000
2025-10-09 22:35:43 - INFO - train_rl_agent:553 -   - Episode max time: 3600.0s
2025-10-09 22:35:43 - INFO - train_rl_agent:554 -   - Checkpoint frequency: 500
2025-10-09 22:35:43 - INFO - train_rl_agent:555 - ================================================================================
2025-10-09 22:35:43 - INFO - _create_scenario_config:203 - Created scenario config: traffic_light_control.yml
2025-10-09 22:35:43 - INFO - _create_scenario_config:204 -   SENSITIVITY FIX: Domain=1km, Riemann IC with shock at 500m
2025-10-09 22:35:43 - INFO - _create_scenario_config:205 -   High density (left): rho_m=100.0 veh/km, rho_c=120.0 veh/km
2025-10-09 22:35:43 - INFO - _create_scenario_config:206 -   Low density (right): rho_m=30.0 veh/km, rho_c=40.0 veh/km
2025-10-09 22:35:50 - ERROR - train_rl_agent:679 - Training failed for traffic_light_control: Left inflow BC requires a 'state' list/array of length 4.
Traceback (most recent call last):
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 662, in train_rl_agent
    model.learn(
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/ppo/ppo.py", line 308, in learn
    return super().learn(
           ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/on_policy_algorithm.py", line 259, in learn
    continue_training = self.collect_rollouts(self.env, callback, self.rollout_buffer, n_rollout_steps=self.n_steps)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/on_policy_algorithm.py", line 178, in collect_rollouts
    new_obs, rewards, dones, infos = env.step(clipped_actions)
                                     ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/vec_env/base_vec_env.py", line 197, in step
    return self.step_wait()
           ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/vec_env/dummy_vec_env.py", line 58, in step_wait
    obs, self.buf_rews[env_idx], terminated, truncated, self.buf_infos[env_idx] = self.envs[env_idx].step(
                                                                                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/monitor.py", line 94, in step
    observation, reward, terminated, truncated, info = self.env.step(action)
                                                       ^^^^^^^^^^^^^^^^^^^^^
  File "/kaggle/working/Code-traffic-flow/Code_RL/src/env/traffic_signal_env_direct.py", line 232, in step
    self.runner.run(t_final=target_time, output_dt=self.decision_interval)
  File "/kaggle/working/Code-traffic-flow/arz_model/simulation/runner.py", line 496, in run
    boundary_conditions.apply_boundary_conditions(current_U, self.grid, self.params, self.current_bc_params, t_current=self.t)
  File "/kaggle/working/Code-traffic-flow/arz_model/numerics/boundary_conditions.py", line 222, in apply_boundary_conditions
    raise ValueError("Left inflow BC requires a 'state' list/array of length 4.")
ValueError: Left inflow BC requires a 'state' list/array of length 4.
2025-10-09 22:35:50 - INFO - train_rl_agent:549 - ================================================================================
2025-10-09 22:35:50 - INFO - train_rl_agent:550 - Starting train_rl_agent for scenario: ramp_metering
2025-10-09 22:35:50 - INFO - train_rl_agent:551 -   - Device: gpu
2025-10-09 22:35:50 - INFO - train_rl_agent:552 -   - Total timesteps: 5000
2025-10-09 22:35:50 - INFO - train_rl_agent:553 -   - Episode max time: 3600.0s
2025-10-09 22:35:50 - INFO - train_rl_agent:554 -   - Checkpoint frequency: 500
2025-10-09 22:35:50 - INFO - train_rl_agent:555 - ================================================================================
2025-10-09 22:35:50 - INFO - _create_scenario_config:203 - Created scenario config: ramp_metering.yml
2025-10-09 22:35:50 - INFO - _create_scenario_config:204 -   SENSITIVITY FIX: Domain=1km, Riemann IC with shock at 500m
2025-10-09 22:35:50 - INFO - _create_scenario_config:205 -   High density (left): rho_m=100.0 veh/km, rho_c=120.0 veh/km
2025-10-09 22:35:50 - INFO - _create_scenario_config:206 -   Low density (right): rho_m=30.0 veh/km, rho_c=40.0 veh/km
2025-10-09 22:35:57 - ERROR - train_rl_agent:679 - Training failed for ramp_metering: Left inflow BC requires a 'state' list/array of length 4.
Traceback (most recent call last):
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 662, in train_rl_agent
    model.learn(
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/ppo/ppo.py", line 308, in learn
    return super().learn(
           ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/on_policy_algorithm.py", line 259, in learn
    continue_training = self.collect_rollouts(self.env, callback, self.rollout_buffer, n_rollout_steps=self.n_steps)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/on_policy_algorithm.py", line 178, in collect_rollouts
    new_obs, rewards, dones, infos = env.step(clipped_actions)
                                     ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/vec_env/base_vec_env.py", line 197, in step
    return self.step_wait()
           ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/vec_env/dummy_vec_env.py", line 58, in step_wait
    obs, self.buf_rews[env_idx], terminated, truncated, self.buf_infos[env_idx] = self.envs[env_idx].step(
                                                                                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/monitor.py", line 94, in step
    observation, reward, terminated, truncated, info = self.env.step(action)
                                                       ^^^^^^^^^^^^^^^^^^^^^
  File "/kaggle/working/Code-traffic-flow/Code_RL/src/env/traffic_signal_env_direct.py", line 232, in step
    self.runner.run(t_final=target_time, output_dt=self.decision_interval)
  File "/kaggle/working/Code-traffic-flow/arz_model/simulation/runner.py", line 496, in run
    boundary_conditions.apply_boundary_conditions(current_U, self.grid, self.params, self.current_bc_params, t_current=self.t)
  File "/kaggle/working/Code-traffic-flow/arz_model/numerics/boundary_conditions.py", line 222, in apply_boundary_conditions
    raise ValueError("Left inflow BC requires a 'state' list/array of length 4.")
ValueError: Left inflow BC requires a 'state' list/array of length 4.
2025-10-09 22:35:57 - INFO - train_rl_agent:549 - ================================================================================
2025-10-09 22:35:57 - INFO - train_rl_agent:550 - Starting train_rl_agent for scenario: adaptive_speed_control
2025-10-09 22:35:57 - INFO - train_rl_agent:551 -   - Device: gpu
2025-10-09 22:35:57 - INFO - train_rl_agent:552 -   - Total timesteps: 5000
2025-10-09 22:35:57 - INFO - train_rl_agent:553 -   - Episode max time: 3600.0s
2025-10-09 22:35:57 - INFO - train_rl_agent:554 -   - Checkpoint frequency: 500
2025-10-09 22:35:57 - INFO - train_rl_agent:555 - ================================================================================
2025-10-09 22:35:57 - INFO - _create_scenario_config:203 - Created scenario config: adaptive_speed_control.yml
2025-10-09 22:35:57 - INFO - _create_scenario_config:204 -   SENSITIVITY FIX: Domain=1km, Riemann IC with shock at 500m
2025-10-09 22:35:57 - INFO - _create_scenario_config:205 -   High density (left): rho_m=100.0 veh/km, rho_c=120.0 veh/km
2025-10-09 22:35:57 - INFO - _create_scenario_config:206 -   Low density (right): rho_m=30.0 veh/km, rho_c=40.0 veh/km
2025-10-09 22:35:57 - ERROR - train_rl_agent:679 - Training failed for adaptive_speed_control: Left inflow BC requires a 'state' list/array of length 4.
Traceback (most recent call last):
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 662, in train_rl_agent
    model.learn(
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/ppo/ppo.py", line 308, in learn
    return super().learn(
           ^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/on_policy_algorithm.py", line 259, in learn
    continue_training = self.collect_rollouts(self.env, callback, self.rollout_buffer, n_rollout_steps=self.n_steps)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/on_policy_algorithm.py", line 178, in collect_rollouts
    new_obs, rewards, dones, infos = env.step(clipped_actions)
                                     ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/vec_env/base_vec_env.py", line 197, in step
    return self.step_wait()
           ^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/vec_env/dummy_vec_env.py", line 58, in step_wait
    obs, self.buf_rews[env_idx], terminated, truncated, self.buf_infos[env_idx] = self.envs[env_idx].step(
                                                                                  ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/dist-packages/stable_baselines3/common/monitor.py", line 94, in step
    observation, reward, terminated, truncated, info = self.env.step(action)
                                                       ^^^^^^^^^^^^^^^^^^^^^
  File "/kaggle/working/Code-traffic-flow/Code_RL/src/env/traffic_signal_env_direct.py", line 232, in step
    self.runner.run(t_final=target_time, output_dt=self.decision_interval)
  File "/kaggle/working/Code-traffic-flow/arz_model/simulation/runner.py", line 496, in run
    boundary_conditions.apply_boundary_conditions(current_U, self.grid, self.params, self.current_bc_params, t_current=self.t)
  File "/kaggle/working/Code-traffic-flow/arz_model/numerics/boundary_conditions.py", line 222, in apply_boundary_conditions
    raise ValueError("Left inflow BC requires a 'state' list/array of length 4.")
ValueError: Left inflow BC requires a 'state' list/array of length 4.
2025-10-09 22:35:57 - INFO - run_performance_comparison:687 - ================================================================================
2025-10-09 22:35:57 - INFO - run_performance_comparison:688 - Starting run_performance_comparison for scenario: traffic_light_control
2025-10-09 22:35:57 - INFO - run_performance_comparison:689 - Device: gpu
2025-10-09 22:35:57 - INFO - run_performance_comparison:690 - ================================================================================
2025-10-09 22:35:57 - INFO - run_performance_comparison:691 - ================================================================================
2025-10-09 22:35:57 - INFO - run_performance_comparison:692 - Starting run_performance_comparison for scenario: traffic_light_control
2025-10-09 22:35:57 - INFO - run_performance_comparison:693 - Device: gpu
2025-10-09 22:35:57 - INFO - run_performance_comparison:694 - ================================================================================
2025-10-09 22:35:57 - INFO - _create_scenario_config:203 - Created scenario config: traffic_light_control.yml
2025-10-09 22:35:57 - INFO - _create_scenario_config:204 -   SENSITIVITY FIX: Domain=1km, Riemann IC with shock at 500m
2025-10-09 22:35:57 - INFO - _create_scenario_config:205 -   High density (left): rho_m=100.0 veh/km, rho_c=120.0 veh/km
2025-10-09 22:35:57 - INFO - _create_scenario_config:206 -   Low density (right): rho_m=30.0 veh/km, rho_c=40.0 veh/km
2025-10-09 22:35:57 - INFO - run_control_simulation:285 - ================================================================================
2025-10-09 22:35:57 - INFO - run_control_simulation:286 - DIAGNOSTIC MODE: MAX 10 STEPS
2025-10-09 22:35:57 - INFO - run_control_simulation:287 - Starting run_control_simulation:
2025-10-09 22:35:57 - INFO - run_control_simulation:288 -   - scenario_path: validation_output/results/local_test/section_7_6_rl_performance/data/scenarios/traffic_light_control.yml
2025-10-09 22:35:57 - INFO - run_control_simulation:289 -   - duration: 3600.0s
2025-10-09 22:35:57 - INFO - run_control_simulation:290 -   - control_interval: 60.0s
2025-10-09 22:35:57 - INFO - run_control_simulation:291 -   - device: gpu
2025-10-09 22:35:57 - INFO - run_control_simulation:292 -   - controller: BaselineController
2025-10-09 22:35:57 - INFO - run_control_simulation:293 - ================================================================================
2025-10-09 22:35:57 - INFO - run_control_simulation:298 - Creating TrafficSignalEnvDirect instance...
2025-10-09 22:35:57 - INFO - run_control_simulation:311 - TrafficSignalEnvDirect created successfully
2025-10-09 22:35:57 - INFO - run_control_simulation:312 -   SENSITIVITY FIX: Observation segments [3-8] ≈ 30-80m from boundary
2025-10-09 22:35:57 - INFO - run_control_simulation:328 - Calling env.reset()...
2025-10-09 22:35:57 - INFO - run_control_simulation:330 - env.reset() successful - obs shape: (26,), info: {'episode_step': 0, 'simulation_time': 0.0, 'current_phase': 0}
2025-10-09 22:35:57 - INFO - run_control_simulation:334 - INITIAL STATE shape: (4, 104), dtype: float64
2025-10-09 22:35:57 - INFO - run_control_simulation:335 - INITIAL STATE statistics: mean=9.035193e+00, std=9.623852e+00, min=1.000000e-04, max=2.500000e+01
2025-10-09 22:35:57 - INFO - run_control_simulation:351 - Starting simulation loop - max 10 steps
2025-10-09 22:35:57 - INFO - run_control_simulation:365 - ================================================================================
2025-10-09 22:35:57 - INFO - run_control_simulation:366 - STEP 0 START:
2025-10-09 22:35:57 - INFO - run_control_simulation:367 -   Controller: BaselineController
2025-10-09 22:35:57 - INFO - run_control_simulation:368 -   Action: 1.000000
2025-10-09 22:35:57 - INFO - run_control_simulation:369 -   Simulation time: 0.00s
2025-10-09 22:35:57 - ERROR - run_control_simulation:386 - env.step() failed at step 0: Left inflow BC requires a 'state' list/array of length 4.
Traceback (most recent call last):
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 378, in run_control_simulation
    obs, reward, terminated, truncated, info = env.step(action)
                                               ^^^^^^^^^^^^^^^^
  File "/kaggle/working/Code-traffic-flow/Code_RL/src/env/traffic_signal_env_direct.py", line 232, in step
    self.runner.run(t_final=target_time, output_dt=self.decision_interval)
  File "/kaggle/working/Code-traffic-flow/arz_model/simulation/runner.py", line 496, in run
    boundary_conditions.apply_boundary_conditions(current_U, self.grid, self.params, self.current_bc_params, t_current=self.t)
  File "/kaggle/working/Code-traffic-flow/arz_model/numerics/boundary_conditions.py", line 222, in apply_boundary_conditions
    raise ValueError("Left inflow BC requires a 'state' list/array of length 4.")
ValueError: Left inflow BC requires a 'state' list/array of length 4.
2025-10-09 22:35:57 - INFO - run_performance_comparison:687 - ================================================================================
2025-10-09 22:35:57 - INFO - run_performance_comparison:688 - Starting run_performance_comparison for scenario: ramp_metering
2025-10-09 22:35:57 - INFO - run_performance_comparison:689 - Device: gpu
2025-10-09 22:35:57 - INFO - run_performance_comparison:690 - ================================================================================
2025-10-09 22:35:57 - INFO - run_performance_comparison:691 - ================================================================================
2025-10-09 22:35:57 - INFO - run_performance_comparison:692 - Starting run_performance_comparison for scenario: ramp_metering
2025-10-09 22:35:57 - INFO - run_performance_comparison:693 - Device: gpu
2025-10-09 22:35:57 - INFO - run_performance_comparison:694 - ================================================================================
2025-10-09 22:35:57 - INFO - _create_scenario_config:203 - Created scenario config: ramp_metering.yml
2025-10-09 22:35:57 - INFO - _create_scenario_config:204 -   SENSITIVITY FIX: Domain=1km, Riemann IC with shock at 500m
2025-10-09 22:35:57 - INFO - _create_scenario_config:205 -   High density (left): rho_m=100.0 veh/km, rho_c=120.0 veh/km
2025-10-09 22:35:57 - INFO - _create_scenario_config:206 -   Low density (right): rho_m=30.0 veh/km, rho_c=40.0 veh/km
2025-10-09 22:35:57 - INFO - run_control_simulation:285 - ================================================================================
2025-10-09 22:35:57 - INFO - run_control_simulation:286 - DIAGNOSTIC MODE: MAX 10 STEPS
2025-10-09 22:35:57 - INFO - run_control_simulation:287 - Starting run_control_simulation:
2025-10-09 22:35:57 - INFO - run_control_simulation:288 -   - scenario_path: validation_output/results/local_test/section_7_6_rl_performance/data/scenarios/ramp_metering.yml
2025-10-09 22:35:57 - INFO - run_control_simulation:289 -   - duration: 3600.0s
2025-10-09 22:35:57 - INFO - run_control_simulation:290 -   - control_interval: 60.0s
2025-10-09 22:35:57 - INFO - run_control_simulation:291 -   - device: gpu
2025-10-09 22:35:57 - INFO - run_control_simulation:292 -   - controller: BaselineController
2025-10-09 22:35:57 - INFO - run_control_simulation:293 - ================================================================================
2025-10-09 22:35:57 - INFO - run_control_simulation:298 - Creating TrafficSignalEnvDirect instance...
2025-10-09 22:35:57 - INFO - run_control_simulation:311 - TrafficSignalEnvDirect created successfully
2025-10-09 22:35:57 - INFO - run_control_simulation:312 -   SENSITIVITY FIX: Observation segments [3-8] ≈ 30-80m from boundary
2025-10-09 22:35:57 - INFO - run_control_simulation:328 - Calling env.reset()...
2025-10-09 22:35:57 - INFO - run_control_simulation:330 - env.reset() successful - obs shape: (26,), info: {'episode_step': 0, 'simulation_time': 0.0, 'current_phase': 0}
2025-10-09 22:35:57 - INFO - run_control_simulation:334 - INITIAL STATE shape: (4, 104), dtype: float64
2025-10-09 22:35:57 - INFO - run_control_simulation:335 - INITIAL STATE statistics: mean=9.028155e+00, std=9.630394e+00, min=1.000000e-04, max=2.500000e+01
2025-10-09 22:35:57 - INFO - run_control_simulation:351 - Starting simulation loop - max 10 steps
2025-10-09 22:35:57 - INFO - run_control_simulation:365 - ================================================================================
2025-10-09 22:35:57 - INFO - run_control_simulation:366 - STEP 0 START:
2025-10-09 22:35:57 - INFO - run_control_simulation:367 -   Controller: BaselineController
2025-10-09 22:35:57 - INFO - run_control_simulation:368 -   Action: 0.500000
2025-10-09 22:35:57 - INFO - run_control_simulation:369 -   Simulation time: 0.00s
2025-10-09 22:35:59 - INFO - run_control_simulation:381 -   Reward: 0.070136
2025-10-09 22:35:59 - INFO - run_control_simulation:382 -   Terminated: False, Truncated: False
2025-10-09 22:35:59 - INFO - run_control_simulation:398 -   STATE EVOLUTION:
2025-10-09 22:35:59 - INFO - run_control_simulation:399 -     Before shape: (4, 104), After shape: (4, 104)
2025-10-09 22:35:59 - INFO - run_control_simulation:400 -     Diff statistics: mean=3.573362e+00, max=1.502685e+01, std=4.148236e+00
2025-10-09 22:35:59 - INFO - run_control_simulation:410 -     Mean densities: rho_m=0.024651, rho_c=0.035606
2025-10-09 22:35:59 - INFO - run_control_simulation:411 -     Mean velocities: w_m=15.033023, w_c=12.639957
2025-10-09 22:35:59 - INFO - run_control_simulation:415 -   State hash: 4558021334523060860
2025-10-09 22:35:59 - INFO - run_control_simulation:417 - ================================================================================
2025-10-09 22:35:59 - INFO - run_control_simulation:365 - ================================================================================
2025-10-09 22:35:59 - INFO - run_control_simulation:366 - STEP 1 START:
2025-10-09 22:35:59 - INFO - run_control_simulation:367 -   Controller: BaselineController
2025-10-09 22:35:59 - INFO - run_control_simulation:368 -   Action: 1.000000
2025-10-09 22:35:59 - INFO - run_control_simulation:369 -   Simulation time: 60.00s
2025-10-09 22:35:59 - ERROR - run_control_simulation:386 - env.step() failed at step 1: Left inflow BC requires a 'state' list/array of length 4.
Traceback (most recent call last):
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 378, in run_control_simulation
    obs, reward, terminated, truncated, info = env.step(action)
                                               ^^^^^^^^^^^^^^^^
  File "/kaggle/working/Code-traffic-flow/Code_RL/src/env/traffic_signal_env_direct.py", line 232, in step
    self.runner.run(t_final=target_time, output_dt=self.decision_interval)
  File "/kaggle/working/Code-traffic-flow/arz_model/simulation/runner.py", line 496, in run
    boundary_conditions.apply_boundary_conditions(current_U, self.grid, self.params, self.current_bc_params, t_current=self.t)
  File "/kaggle/working/Code-traffic-flow/arz_model/numerics/boundary_conditions.py", line 222, in apply_boundary_conditions
    raise ValueError("Left inflow BC requires a 'state' list/array of length 4.")
ValueError: Left inflow BC requires a 'state' list/array of length 4.
2025-10-09 22:35:59 - INFO - run_performance_comparison:687 - ================================================================================
2025-10-09 22:35:59 - INFO - run_performance_comparison:688 - Starting run_performance_comparison for scenario: adaptive_speed_control
2025-10-09 22:35:59 - INFO - run_performance_comparison:689 - Device: gpu
2025-10-09 22:35:59 - INFO - run_performance_comparison:690 - ================================================================================
2025-10-09 22:35:59 - INFO - run_performance_comparison:691 - ================================================================================
2025-10-09 22:35:59 - INFO - run_performance_comparison:692 - Starting run_performance_comparison for scenario: adaptive_speed_control
2025-10-09 22:35:59 - INFO - run_performance_comparison:693 - Device: gpu
2025-10-09 22:35:59 - INFO - run_performance_comparison:694 - ================================================================================
2025-10-09 22:35:59 - INFO - _create_scenario_config:203 - Created scenario config: adaptive_speed_control.yml
2025-10-09 22:35:59 - INFO - _create_scenario_config:204 -   SENSITIVITY FIX: Domain=1km, Riemann IC with shock at 500m
2025-10-09 22:35:59 - INFO - _create_scenario_config:205 -   High density (left): rho_m=100.0 veh/km, rho_c=120.0 veh/km
2025-10-09 22:35:59 - INFO - _create_scenario_config:206 -   Low density (right): rho_m=30.0 veh/km, rho_c=40.0 veh/km
2025-10-09 22:35:59 - INFO - run_control_simulation:285 - ================================================================================
2025-10-09 22:35:59 - INFO - run_control_simulation:286 - DIAGNOSTIC MODE: MAX 10 STEPS
2025-10-09 22:35:59 - INFO - run_control_simulation:287 - Starting run_control_simulation:
2025-10-09 22:35:59 - INFO - run_control_simulation:288 -   - scenario_path: validation_output/results/local_test/section_7_6_rl_performance/data/scenarios/adaptive_speed_control.yml
2025-10-09 22:35:59 - INFO - run_control_simulation:289 -   - duration: 3600.0s
2025-10-09 22:35:59 - INFO - run_control_simulation:290 -   - control_interval: 60.0s
2025-10-09 22:35:59 - INFO - run_control_simulation:291 -   - device: gpu
2025-10-09 22:35:59 - INFO - run_control_simulation:292 -   - controller: BaselineController
2025-10-09 22:35:59 - INFO - run_control_simulation:293 - ================================================================================
2025-10-09 22:35:59 - INFO - run_control_simulation:298 - Creating TrafficSignalEnvDirect instance...
2025-10-09 22:35:59 - INFO - run_control_simulation:311 - TrafficSignalEnvDirect created successfully
2025-10-09 22:35:59 - INFO - run_control_simulation:312 -   SENSITIVITY FIX: Observation segments [3-8] ≈ 30-80m from boundary
2025-10-09 22:35:59 - INFO - run_control_simulation:328 - Calling env.reset()...
2025-10-09 22:35:59 - INFO - run_control_simulation:330 - env.reset() successful - obs shape: (26,), info: {'episode_step': 0, 'simulation_time': 0.0, 'current_phase': 0}
2025-10-09 22:35:59 - INFO - run_control_simulation:334 - INITIAL STATE shape: (4, 104), dtype: float64
2025-10-09 22:35:59 - INFO - run_control_simulation:335 - INITIAL STATE statistics: mean=9.024636e+00, std=9.633667e+00, min=1.000000e-04, max=2.500000e+01
2025-10-09 22:35:59 - INFO - run_control_simulation:351 - Starting simulation loop - max 10 steps
2025-10-09 22:35:59 - INFO - run_control_simulation:365 - ================================================================================
2025-10-09 22:35:59 - INFO - run_control_simulation:366 - STEP 0 START:
2025-10-09 22:35:59 - INFO - run_control_simulation:367 -   Controller: BaselineController
2025-10-09 22:35:59 - INFO - run_control_simulation:368 -   Action: 0.800000
2025-10-09 22:35:59 - INFO - run_control_simulation:369 -   Simulation time: 0.00s
2025-10-09 22:36:01 - INFO - run_control_simulation:381 -   Reward: 0.070136
2025-10-09 22:36:01 - INFO - run_control_simulation:382 -   Terminated: False, Truncated: False
2025-10-09 22:36:01 - INFO - run_control_simulation:398 -   STATE EVOLUTION:
2025-10-09 22:36:01 - INFO - run_control_simulation:399 -     Before shape: (4, 104), After shape: (4, 104)
2025-10-09 22:36:01 - INFO - run_control_simulation:400 -     Diff statistics: mean=3.536235e+00, max=1.519160e+01, std=4.254468e+00
2025-10-09 22:36:01 - INFO - run_control_simulation:410 -     Mean densities: rho_m=0.019823, rho_c=0.029762
2025-10-09 22:36:01 - INFO - run_control_simulation:411 -     Mean velocities: w_m=15.752390, w_c=13.212738
2025-10-09 22:36:01 - INFO - run_control_simulation:415 -   State hash: 7767245140030899547
2025-10-09 22:36:01 - INFO - run_control_simulation:417 - ================================================================================
2025-10-09 22:36:01 - INFO - run_control_simulation:365 - ================================================================================
2025-10-09 22:36:01 - INFO - run_control_simulation:366 - STEP 1 START:
2025-10-09 22:36:01 - INFO - run_control_simulation:367 -   Controller: BaselineController
2025-10-09 22:36:01 - INFO - run_control_simulation:368 -   Action: 1.000000
2025-10-09 22:36:01 - INFO - run_control_simulation:369 -   Simulation time: 60.00s
2025-10-09 22:36:01 - ERROR - run_control_simulation:386 - env.step() failed at step 1: Left inflow BC requires a 'state' list/array of length 4.
Traceback (most recent call last):
  File "/kaggle/working/Code-traffic-flow/validation_ch7/scripts/test_section_7_6_rl_performance.py", line 378, in run_control_simulation
    obs, reward, terminated, truncated, info = env.step(action)
                                               ^^^^^^^^^^^^^^^^
  File "/kaggle/working/Code-traffic-flow/Code_RL/src/env/traffic_signal_env_direct.py", line 232, in step
    self.runner.run(t_final=target_time, output_dt=self.decision_interval)
  File "/kaggle/working/Code-traffic-flow/arz_model/simulation/runner.py", line 496, in run
    boundary_conditions.apply_boundary_conditions(current_U, self.grid, self.params, self.current_bc_params, t_current=self.t)
  File "/kaggle/working/Code-traffic-flow/arz_model/numerics/boundary_conditions.py", line 222, in apply_boundary_conditions
    raise ValueError("Left inflow BC requires a 'state' list/array of length 4.")
ValueError: Left inflow BC requires a 'state' list/array of length 4.
